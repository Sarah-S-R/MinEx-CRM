<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Sarah Ryan">
    <meta name="keywords" content="Mineral Exploration, Geology, CRM, Consulting Firm">
    <link rel="stylesheet" type="text/css" href="./css/dashstyles.css">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <title>MinEx CRM: Dashboard</title>   
</head>
<body>
    <div class="grid-container">
        <!----------------------------------Header----------------------------------------------->
        <header class="header">
            <div class="menu-icon" onclick="openSidebar()">
                <span class="material-icons-outlined">menu</span>
            </div>
            <div class="header-left">

                <div id="datetime"></div> <!-- Container for date and time -->
            </div>
            <div class="header-right">
                <div class="dropdown">
                    <a class="dropdown-toggle" href="#" >

                </div>      
                <div class="dropdown">
                    <a class="dropdown-toggle" href="profile.html">
                        <span class="material-icons-outlined userAccountCircle">account_circle</span></a>
                </div>
            </div>
        </header>
        <!-------------------------------------End Header-------------------------------------->

        <!--------------------------------------Sidebar----------------------------------------->
        <aside id="sidebar">
            <div class="sidebar-title">
                <div class="sidebar-brand">
                    <span class="logoIcon"><img src="/icons/minex.png">MinEx</span>
                </div>
                <div class="close-icon" onclick="closeSidebar()">
                    <span class="material-icons-outlined">close</span>
                </div>
            </div>

            <ul class="sidebar-list">
                <li class="sidebar-list-item">
                    <a href="dashboard.html">
                    <span class="material-icons-outlined">dashboard</span>Dashboard
                    </a>
                </li>
                <li class="sidebar-list-item">
                    <a href="clients.html">
                    <span class="material-icons-outlined">groups</span>Clients
                </a>
                </li>
                <li class="sidebar-list-item">
                    <a href="projects.html">
                    <span class="material-icons-outlined">inventory_2</span>Projects
                </a>
                </li>
                <li class="sidebar-list-item">
                    <a href="locations.html">
                    <span class="material-icons-outlined">map</span>Locations
                </a>
                </li>
                <li class="sidebar-list-item">
                    <a href="#" class="logout">  <span class="material-icons-outlined">logout</span> Log Out</a>
                </li>
            </ul>
        </aside>
        <!---------------------------------------End Sidebar------------------------------------>

        <!-------------------------------------------Main---------------------------------------->
        <main class="main-container">
            <div class="main-title">
                <h2>DASHBOARD</h2>
            </div>
            <div class="welcome-container" id="welcome-container">
                <h2>Welcome back</h2>
                </div>
            <div class="main-cards">

               <button onclick="window.location.href='clients.html'" class="card"> 
                <div class="card">
                    <div class="card-inner">
                        
                        <span class="material-icons-outlined">groups</span> 
                        <h3>CLIENTS</h3>
                    </div>
                 <h1 id="clientCount"></h1> 
                </div>
                </button>
           
                <button onclick="window.location.href='projects.html'" class="card"> 
                <div class="card">
                    <div class="card-inner">
                        <span class="material-icons-outlined">inventory_2</span>
                        <h3>PROJECTS</h3>   
                    </div>
                  <h1 id="projectCount"></h1> 
                </div>
            </button>
            <button onclick="window.location.href='locations.html'" class="card">
                <div class="card">
                    <div class="card-inner"> 
                        <span class="material-icons-outlined">map</span>
                        <h3>LOCATIONS</h3>
                    </div>
                    <h1 id="markerCount"></h1>
                </div>
            </button>
        </main>
        <!---------------------------------End Main--------------------------------------->

        <!----------------------------------JAVASCRIPTS----------------------------------->
        
        <script src="/js/auth.js"></script>
        <script src="/init.js"></script>
        <script src="/js/scripts.js"></script>
        <script src="/js/client.js"></script>
        <script src="/js/projects.js"></script>
        <script src="/js/locations.js"></script>
        
        <script>
          // Function to count markers
          function countMarkers() {
            try {
              // Retrieve the marker count from localStorage or any other logic you are using
              // Ensure that this logic matches your implementation in locations.js
              const storedLocations = JSON.parse(localStorage.getItem("locations")) || [];
              return storedLocations.length;
            } catch (error) {
              console.error("Error counting markers:", error);
              return 0; // Return 0 in case of an error
            }
          }
        
          // Function to update marker count on the dashboard
          function updateMarkerCount() {
            try {
              const markerCountElement = document.getElementById("markerCount");
        
              if (markerCountElement) {
                const count = countMarkers(); // Call the countMarkers function
                console.log("Marker count:", count); // Log the count to the console for debugging
        
                if (typeof count === "number" && !isNaN(count)) {
                  markerCountElement.textContent = `${count}`;
                } else {
                  console.error("Invalid marker count:", count);
                  markerCountElement.textContent = "Error: Invalid count";
                }
              } else {
                console.error("Marker count element not found!");
              }
            } catch (error) {
              console.error("Error updating marker count:", error);
              markerCountElement.textContent = "Error updating count";
            }
          }
        
          // Call functions in the correct order
          updateMarkerCount();
        </script>
</body>
</html>